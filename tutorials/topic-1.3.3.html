<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>I/O & File Systems</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }

        .container {
            background-color: white;
            padding: 40px;
            box-shadow: 0 0 20px rgba(0,0,0,0.1);
        }

        h1 {
            color: #2c3e50;
            border-bottom: 4px solid #3498db;
            padding-bottom: 15px;
            margin-bottom: 30px;
            font-size: 2.5em;
        }

        h2 {
            color: #2980b9;
            margin-top: 40px;
            margin-bottom: 20px;
            font-size: 1.8em;
            border-left: 5px solid #3498db;
            padding-left: 15px;
        }

        h3 {
            color: #34495e;
            margin-top: 30px;
            margin-bottom: 15px;
            font-size: 1.4em;
        }

        h4 {
            color: #555;
            margin-top: 20px;
            margin-bottom: 10px;
            font-size: 1.1em;
        }

        p {
            margin-bottom: 15px;
            text-align: justify;
        }

        ul, ol {
            margin-left: 30px;
            margin-bottom: 15px;
        }

        li {
            margin-bottom: 8px;
        }

        .info-box {
            background-color: #e8f4f8;
            border-left: 4px solid #3498db;
            padding: 15px;
            margin: 20px 0;
        }

        code {
            background-color: #f4f4f4;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: 'Courier New', Courier, monospace;
            font-size: 0.9em;
        }

        pre {
            background-color: #f8f9fa;
            color: #2c3e50;
            padding: 20px;
            border-radius: 5px;
            overflow-x: auto;
            margin: 20px 0;
            font-family: 'Courier New', Courier, monospace;
            line-height: 1.4;
            border: 1px solid #e0e7f0;
        }

        pre code {
            background-color: transparent;
            color: inherit;
            padding: 0;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            background-color: white;
        }

        th {
            background-color: #3498db;
            color: white;
            padding: 12px;
            text-align: left;
            font-weight: bold;
        }

        td {
            padding: 12px;
            border-bottom: 1px solid #ddd;
        }

        tr:hover {
            background-color: #f5f5f5;
        }

        .diagram {
            background-color: #f9f9f9;
            border: 2px solid #ddd;
            padding: 20px;
            margin: 20px 0;
            font-family: monospace;
            white-space: pre;
            overflow-x: auto;
        }

        .key-concept {
            background-color: #e8f4f8;
            border: 2px solid #3498db;
            padding: 20px;
            margin: 20px 0;
            border-radius: 5px;
        }

        .visual-example {
            background-color: #f0f8ff;
            border: 2px solid #87ceeb;
            padding: 20px;
            margin: 20px 0;
            border-radius: 5px;
        }

        .nav-links {
            display: flex;
            justify-content: space-between;
            margin-top: 40px;
            padding-top: 20px;
            border-top: 2px solid #ddd;
        }

        .nav-link {
            display: inline-block;
            padding: 10px 20px;
            background-color: #3498db;
            color: white;
            text-decoration: none;
            border-radius: 5px;
            transition: background-color 0.3s;
        }

        .nav-link:hover {
            background-color: #2980b9;
        }

        .breadcrumb {
            background-color: #f8f9fa;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 30px;
            font-size: 0.95em;
        }

        .breadcrumb a {
            color: #3498db;
            text-decoration: none;
        }

        .breadcrumb a:hover {
            text-decoration: underline;
        }

        @media (max-width: 768px) {
            h1 {
                font-size: 2em;
            }

            h2 {
                font-size: 1.5em;
            }

            .container {
                padding: 20px;
            }

            body {
                padding: 10px;
            }

            table {
                font-size: 0.9em;
            }
        }

        html {
            scroll-behavior: smooth;
        }

        pre:hover {
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }

        a {
            transition: all 0.2s ease;
        }

        .info-box {
            transition: transform 0.2s ease;
        }

        .info-box:hover {
            transform: translateX(5px);
        }
        .breadcrumb-nav {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 30px;
            font-size: 14px;
            color: #666;
        }

        .breadcrumb-nav a {
            color: #3498db;
            text-decoration: none;
            font-weight: 500;
        }

        .breadcrumb-nav a:hover {
            text-decoration: underline;
            color: #2980b9;
        }

        .breadcrumb-separator {
            color: #ccc;
        }

        .breadcrumb-current {
            color: #2c3e50;
            font-weight: 600;
        }

    </style>
</head>
<body>
    <!-- Breadcrumb Navigation -->
    <div class="breadcrumb-nav">
        <a href="../blog.html">Learning Hub</a>
        <span class="breadcrumb-separator">/</span>
        <a href="./hubs/systems.html">Systems</a>
        <span class="breadcrumb-separator">/</span>
        <span class="breadcrumb-current">I/O & File Systems</span>
    </div>

    <div class="container">
        <h1>I/O & File Systems</h1>
        <p style="color: #666; font-style: italic; margin-bottom: 20px;">Understanding How Operating Systems Manage Persistent Storage and File Access</p>

        <div class="key-concept">
            <h3>What You'll Learn</h3>
            <ul>
                <li><strong>File System Hierarchy</strong> - Directory structure and file organization</li>
                <li><strong>Inodes</strong> - How the OS stores file metadata</li>
                <li><strong>Data Block Allocation</strong> - Direct, indirect, and multi-level indexing</li>
                <li><strong>Directory Structure</strong> - Mapping filenames to inodes</li>
                <li><strong>File Operations</strong> - open, read, write, close system calls</li>
            </ul>
        </div>

        <h2>File Systems</h2>

        <h3>File System Hierarchy</h3>

        <div class="diagram">
Unix/Linux File System Tree:

                    / (root)
         ┌──────────┼──────────┐
         │          │          │
       /bin       /home      /etc
         │          │          │
         │          ├─ alice   ├─ passwd
         │          │          └─ hosts
         │          └─ bob
         │
       /usr
         │
         ├─ bin
         ├─ lib
         └─ local

Everything is a file:
• Regular files (data.txt)
• Directories (folders)
• Devices (/dev/sda, /dev/null)
• Pipes, Sockets
        </div>

        <h3>Inode (Index Node)</h3>

        <p>An <strong>inode</strong> is the OS's data structure for storing file metadata.</p>

        <table>
            <thead>
                <tr>
                    <th>Field</th>
                    <th>Description</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td><strong>Inode Number</strong></td>
                    <td>Unique ID for file</td>
                </tr>
                <tr>
                    <td><strong>File Type</strong></td>
                    <td>Regular, directory, symlink, device, etc.</td>
                </tr>
                <tr>
                    <td><strong>Permissions</strong></td>
                    <td>rwxrwxrwx (owner, group, others)</td>
                </tr>
                <tr>
                    <td><strong>Owner UID/GID</strong></td>
                    <td>User and group IDs</td>
                </tr>
                <tr>
                    <td><strong>File Size</strong></td>
                    <td>Size in bytes</td>
                </tr>
                <tr>
                    <td><strong>Timestamps</strong></td>
                    <td>Access time, modification time, change time</td>
                </tr>
                <tr>
                    <td><strong>Link Count</strong></td>
                    <td>Number of hard links</td>
                </tr>
                <tr>
                    <td><strong>Data Block Pointers</strong></td>
                    <td>Where file's data is stored</td>
                </tr>
            </tbody>
        </table>

        <div class="info-box">
            <strong>Key Insight:</strong> The filename is NOT stored in the inode! It's stored in the directory entry that points to the inode.
        </div>

        <h3>File Data Block Allocation</h3>

        <div class="diagram">
Inode Structure (Unix):

┌─────────────────────────────┐
│ Inode Metadata              │
│ - Type, permissions, etc.   │
├─────────────────────────────┤
│ Direct Pointers (12)        │
│  [0] → Block 123            │ ← Small files (48KB)
│  [1] → Block 456            │
│  ...                        │
│  [11] → Block 789           │
├─────────────────────────────┤
│ Single Indirect Pointer     │ ← Medium files
│  → Block 900                │   (up to ~4MB)
│      [0] → Block 1000       │
│      [1] → Block 1001       │
│      ...                    │
├─────────────────────────────┤
│ Double Indirect Pointer     │ ← Large files
│  → Block 1100               │   (up to ~4GB)
│      [0] → Block 1200       │
│          [0] → Block 2000   │
│          [1] → Block 2001   │
│      [1] → Block 1201       │
│          ...                │
├─────────────────────────────┤
│ Triple Indirect Pointer     │ ← Huge files
│  → ...                      │   (up to ~4TB)
└─────────────────────────────┘
        </div>

        <h3>Directory Structure</h3>

        <p>A directory is just a special file that maps filenames to inode numbers.</p>

        <div class="visual-example">
            <h4>Directory Entries</h4>
            <pre><code>Directory: /home/alice/

┌──────────────┬───────────┬──────────────┐
│ Inode Number │ Name Len  │ Filename     │
├──────────────┼───────────┼──────────────┤
│ 12345        │ 1         │ .            │ (current dir)
│ 12000        │ 2         │ ..           │ (parent dir)
│ 12346        │ 8         │ file.txt     │
│ 12347        │ 9         │ photo.jpg    │
│ 12348        │ 4         │ docs         │ (subdirectory)
└──────────────┴───────────┴──────────────┘

To open /home/alice/file.txt:
1. Start at root inode (/)
2. Read root's directory, find "home" → inode 12000
3. Read inode 12000's directory, find "alice" → inode 12345
4. Read inode 12345's directory, find "file.txt" → inode 12346
5. Read inode 12346 to get file metadata and data blocks</code></pre>
        </div>

        <h3>File Operations</h3>

        <div class="visual-example">
            <h4>Common File Operations in C</h4>
            <pre><code>#include &lt;fcntl.h&gt;
#include &lt;unistd.h&gt;
#include &lt;stdio.h&gt;

int main() {
    // Open file (returns file descriptor)
    int fd = open("test.txt", O_RDWR | O_CREAT, 0644);
    if (fd < 0) {
        perror("open failed");
        return 1;
    }

    // Write data
    const char* msg = "Hello, OS!\n";
    ssize_t written = write(fd, msg, 11);
    printf("Wrote %zd bytes\n", written);

    // Seek to beginning
    lseek(fd, 0, SEEK_SET);

    // Read data
    char buffer[100];
    ssize_t nread = read(fd, buffer, sizeof(buffer));
    printf("Read %zd bytes: %s\n", nread, buffer);

    // Get file info
    struct stat st;
    fstat(fd, &st);
    printf("File size: %ld bytes\n", st.st_size);
    printf("Inode: %ld\n", st.st_ino);
    printf("Permissions: %o\n", st.st_mode & 0777);

    // Close file
    close(fd);

    return 0;
}</code></pre>
        </div>

        <h3>File Descriptor Table</h3>

        <p>When a process opens a file, the OS maintains a <strong>file descriptor table</strong>:</p>

        <div class="diagram">
Per-Process File Descriptor Table:

Process 1234
┌────────────────────────────────┐
│ File Descriptor Table          │
├────┬───────────────────────────┤
│ 0  │ stdin  (standard input)   │
│ 1  │ stdout (standard output)  │
│ 2  │ stderr (standard error)   │
│ 3  │ → Open File Entry (log)   │
│ 4  │ → Open File Entry (data)  │
│ ...│                            │
└────┴───────────────────────────┘
        │
        ├─────────────────┐
        ▼                 ▼
   ┌─────────────┐  ┌─────────────┐
   │ Open File   │  │ Open File   │
   │ Entry       │  │ Entry       │
   │             │  │             │
   │ offset: 0   │  │ offset: 42  │
   │ mode: read  │  │ mode: write │
   │ inode: 567  │  │ inode: 890  │
   └─────────────┘  └─────────────┘
        </div>

        <h3>Hard Links vs Symbolic Links</h3>

        <table>
            <thead>
                <tr>
                    <th>Aspect</th>
                    <th>Hard Link</th>
                    <th>Symbolic (Soft) Link</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td><strong>What it is</strong></td>
                    <td>Direct reference to inode</td>
                    <td>Pointer to pathname</td>
                </tr>
                <tr>
                    <td><strong>Link count</strong></td>
                    <td>Increments inode link count</td>
                    <td>Doesn't affect link count</td>
                </tr>
                <tr>
                    <td><strong>Original deleted?</strong></td>
                    <td>File still accessible</td>
                    <td>Link becomes broken</td>
                </tr>
                <tr>
                    <td><strong>Cross filesystems</strong></td>
                    <td>No</td>
                    <td>Yes</td>
                </tr>
                <tr>
                    <td><strong>Directories</strong></td>
                    <td>No (usually)</td>
                    <td>Yes</td>
                </tr>
                <tr>
                    <td><strong>Overhead</strong></td>
                    <td>None</td>
                    <td>Extra inode, extra lookup</td>
                </tr>
            </tbody>
        </table>

        <div class="visual-example">
            <h4>Example: Creating Links</h4>
            <pre><code>$ echo "Hello" > original.txt
$ ln original.txt hardlink.txt       # Hard link
$ ln -s original.txt symlink.txt     # Symbolic link

$ ls -li
12345 -rw-r--r-- 2 alice users  6 Jan 1 12:00 original.txt
12345 -rw-r--r-- 2 alice users  6 Jan 1 12:00 hardlink.txt
12346 lrwxrwxrwx 1 alice users 12 Jan 1 12:01 symlink.txt -> original.txt

Note: original.txt and hardlink.txt have SAME inode (12345)
      symlink.txt has DIFFERENT inode (12346) and is a symlink (l)</code></pre>
        </div>

        <h3>File System Performance</h3>

        <div class="key-concept">
            <h4>Optimization Techniques</h4>
            <ul>
                <li><strong>Buffer Cache</strong> - Cache frequently accessed disk blocks in RAM</li>
                <li><strong>Read-ahead</strong> - Prefetch subsequent blocks during sequential reads</li>
                <li><strong>Write-behind</strong> - Delay writes and batch them for efficiency</li>
                <li><strong>Block grouping</strong> - Store related blocks together (e.g., ext4 block groups)</li>
                <li><strong>Journaling</strong> - Log changes before writing to prevent corruption</li>
            </ul>
        </div>

        <h3>Common File Systems</h3>

        <table>
            <thead>
                <tr>
                    <th>File System</th>
                    <th>OS</th>
                    <th>Key Features</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td><strong>ext4</strong></td>
                    <td>Linux</td>
                    <td>Journaling, extents, up to 1 EB</td>
                </tr>
                <tr>
                    <td><strong>NTFS</strong></td>
                    <td>Windows</td>
                    <td>Journaling, ACLs, compression</td>
                </tr>
                <tr>
                    <td><strong>APFS</strong></td>
                    <td>macOS</td>
                    <td>Copy-on-write, encryption, snapshots</td>
                </tr>
                <tr>
                    <td><strong>FAT32</strong></td>
                    <td>Cross-platform</td>
                    <td>Simple, widely compatible, 4GB file limit</td>
                </tr>
                <tr>
                    <td><strong>Btrfs</strong></td>
                    <td>Linux</td>
                    <td>Copy-on-write, snapshots, RAID</td>
                </tr>
                <tr>
                    <td><strong>ZFS</strong></td>
                    <td>Solaris/Linux</td>
                    <td>Enterprise, data integrity, snapshots</td>
                </tr>
            </tbody>
        </table>

        <div class="nav-links">
            <a href="topic-1.3.2.html" class="nav-link">← Previous: Virtual Memory</a>
            <a href="topic-1.3.4.html" class="nav-link">Next: Synchronization →</a>
        </div>

        <hr style="margin: 40px 0; border: none; border-top: 2px solid #ddd;">

        <div style="background-color: #e8f5e9; border-left: 4px solid #4caf50; padding: 15px; margin: 20px 0; border-radius: 5px;">
            <strong>Continue Learning:</strong><br>
            → <a href="topic-1.3.4.html">Topic 1.3.4: Synchronization & Concurrency</a> - Master thread synchronization<br>
            → <a href="topic-1.3.0.html">Back to Overview</a> - Review OS fundamentals<br>
            → <a href="topic-1.3.1.html">Processes & Scheduling</a> - Review process management
        </div>
    </div>
</body>
</html>
